var PTB_Submission_Map=function(){var d=jQuery;var f;function e(j,h,i,g){f.geocode({latLng:{lat:typeof j.lat=="function"?j.lat():j.lat,lng:typeof j.lng=="function"?j.lng():j.lng}},function(k){if(k&&k.length>0){h.setContent(k[0].formatted_address);h.open(i,g)}else{h.close();h.setContent("")}})}function b(i,g,h){i.val(JSON.stringify({place:g,location:[h.lat(),h.lng()]}))}function a(i){if(!f){f=new google.maps.Geocoder()}var j={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13,mapTypeControl:true,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}};var g=new google.maps.Map(document.getElementById("ptb_extra_"+i+"_canvas"),j);var r=(document.getElementById("ptb_extra_"+i+"_location"));var h=new google.maps.places.Autocomplete(r);h.bindTo("bounds",g);var m=new google.maps.InfoWindow({maxWidth:300});var n=new google.maps.Marker({map:g,draggable:true,position:j.center,animation:google.maps.Animation.DROP,anchorPoint:new google.maps.Point(0,-29)});n.setVisible(true);var p=false;var k=d("#ptb_extra_"+i+"_place");var l=k.val();if(l){l=d.parseJSON(l);if(l){if(l.place){var o=new google.maps.places.PlacesService(g);o.getDetails({placeId:l.place},function(t,s){if(s==google.maps.places.PlacesServiceStatus.OK){p=t;google.maps.event.trigger(h,"place_changed",i);if(t.formatted_address){d(r).val(t.formatted_address)}else{d(r).val(t.name)}}})}else{if(l.location){var q={lat:l.location[0],lng:l.location[1]};n.setPosition(q);g.setCenter(q);e(q,m,g,n);delete q}}}}google.maps.event.addListener(g,"click",function(s){n.setPosition(s.latLng);e(s.latLng,m,g,n);b(k,"",s.latLng)});google.maps.event.addListener(n,"dragstart",function(){m.close()});google.maps.event.addListener(n,"dragend",function(){var s=n.getPosition();e(s,m,g,n);b(k,"",s)});google.maps.event.addListener(n,"click",function(){m.open(g,n)});google.maps.event.addListener(h,"place_changed",function(){m.close();var t="";if(!p){var s=h.getPlace();if(!s||!s.geometry){alert("Autocomplete's returned place contains no geometry");return}}else{var s=p;p=false}if(s.geometry.viewport){g.fitBounds(s.geometry.viewport)}else{g.setCenter(s.geometry.location);g.setZoom(17)}n.setIcon(({url:s.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}));n.setPosition(s.geometry.location);n.setVisible(true);if(!p&&s.address_components){t=[(s.address_components[0]&&s.address_components[0].short_name||""),(s.address_components[1]&&s.address_components[1].short_name||""),(s.address_components[2]&&s.address_components[2].short_name||"")].join(" ");t="<div><strong>"+s.name+"</strong><br>"+t}m.setContent(t);m.open(g,n);b(k,s.place_id,s.geometry.location)})}var c=d(".ptb_extras_submission_map");c.each(function(){a(d(this).data("id"))})};(function(b){function a(d,e){var c=document.createElement("script");c.type="text/javascript";c.async="async";c.defer="defer";if(e){c.onload=e}document.getElementsByTagName("head")[0].appendChild(c);c.src=d}b(document).ready(function(){if(typeof google!=="object"||typeof google.maps!=="object"||typeof google.maps.places==="undefined"){if(typeof google==="object"&&google!==null&&typeof google.maps==="object"&&typeof google.maps.places==="undefined"){google.maps=null}a("//maps.googleapis.com/maps/api/js?v=3.exp&signed_in=false&sensor=false&libraries=places&callback=PTB_Submission_Map&language="+ptb_submission.lng+"&key="+ptb_extra.map_key)}else{PTB_Submission_Map()}});b(document).on("ptb_submission_validate",function(d,c){c=b(this);if(c.closest(".ptb_extra_submission_map_control").length>0){return c.is(":hidden")&&!b.trim(c.val())}})}(jQuery));