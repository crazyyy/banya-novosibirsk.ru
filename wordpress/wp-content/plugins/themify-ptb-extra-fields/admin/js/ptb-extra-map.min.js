function ptb_extra_map_init(c){var b=jQuery,a=b(".ptb_post_cmb_item_map");a.each(function(){var h={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13},g=b(this).prop("id"),e=new google.maps.Map(document.getElementById("ptb_extra_"+g+"_canvas"),h),p=(document.getElementById("ptb_extra_"+g+"_location")),n=document.getElementById("ptb_extra_"+g+"_select");e.controls[google.maps.ControlPosition.TOP_LEFT].push(p);e.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var f=new google.maps.places.Autocomplete(p);f.bindTo("bounds",e);var k=new google.maps.InfoWindow();var l=new google.maps.Marker({map:e,anchorPoint:new google.maps.Point(0,-29)});var o=false;var i=b("#ptb_extra_"+g+"_place");var d=b("#ptb_extra_"+g+"_info");var j=i.val();if(j){j=b.parseJSON(j);if(j){if(j.place){var m=new google.maps.places.PlacesService(e);m.getDetails({placeId:j.place},function(r,q){if(q==google.maps.places.PlacesServiceStatus.OK){o=r;google.maps.event.trigger(f,"place_changed",c);if(r.formatted_address){b(p).val(r.formatted_address)}else{b(p).val(r.name)}}})}else{if(j.location){l.setPosition({lat:j.location[0],lng:j.location[1]});e.setCenter({lat:j.location[0],lng:j.location[1]});if(b.trim(d.val())){k.setContent(b.trim(d.val()));k.open(e,l)}}}}}google.maps.event.addListener(f,"place_changed",function(){k.close();l.setVisible(false);var r="";if(!o){var q=f.getPlace();if(!q||!q.geometry){alert("Autocomplete's returned place contains no geometry");return}}else{var q=o;r=b.trim(d.val());o=false}if(q.geometry.viewport){e.fitBounds(q.geometry.viewport)}else{e.setCenter(q.geometry.location);e.setZoom(17)}l.setIcon(({url:q.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}));l.setPosition(q.geometry.location);l.setVisible(true);if(!o){if(!b.trim(d.val())){if(q.address_components){r=[(q.address_components[0]&&q.address_components[0].short_name||""),(q.address_components[1]&&q.address_components[1].short_name||""),(q.address_components[2]&&q.address_components[2].short_name||"")].join(" ")}d.val(r);r="<div><strong>"+q.name+"</strong><br>"+r}else{r=b.trim(d.val()).replace(/(?:\r\n|\r|\n)/ig,"<br />")}}k.setContent(r);k.open(e,l);i.val(JSON.stringify({place:q.place_id,location:q.geometry.location}))});google.maps.event.addListener(l,"click",function(){k.open(e,l)});b(n).change(function(){f.setTypes([b(this).val()])});d.keyup(function(){var q=b.trim(b(this).val()).replace(/(?:\r\n|\r|\n)/ig,"<br />");k.setContent(q)})})}(function(b){b(document).on("ptb_metabox_create_map",function(c){});b(document).on("ptb_add_metabox_map",function(c){return{}});b(document).on("ptb_metabox_save_map",function(c){});function a(d,e){var c=document.createElement("script");c.type="text/javascript";if(e){c.onload=e}document.getElementsByTagName("head")[0].appendChild(c);c.defer=true;c.async=true;c.src=d}b(document).on("ptb_post_cmb_map_body_handle",function(c){});b(document).ready(function(){if(b(".ptb_post_cmb_item_map").length>0){if(typeof google!=="object"||typeof google.maps!=="object"||typeof google.maps.places==="undefined"){if(typeof google==="object"&&google!==null&&typeof google.maps==="object"&&typeof google.maps.places==="undefined"){google.maps=null}a("//maps.googleapis.com/maps/api/js?v=3&signed_in=false&libraries=places&callback=ptb_extra_map_init&language="+ptb_extra.lng+"&key="+ptb_extra.map_key)}else{ptb_extra_map_init()}}})}(jQuery));