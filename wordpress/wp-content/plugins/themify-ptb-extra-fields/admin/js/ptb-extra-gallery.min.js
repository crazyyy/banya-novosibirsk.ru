(function(b){b(document).on("ptb_add_metabox_gallery",function(c){return{}});function a(j,i,e){var h=e?e:b("#"+i+"_options_wrapper li").last();h.find('input[name^="'+i+'[url]"]').val(j.url);var g=b("#auto_draft").length>0,c=h.find(".ptb_post_cmb_image");var f=h.find('input[name^="'+i+'[title]"]');if(g||!b.trim(f.val())){f.val(j.title)}var d=h.find("textarea");if(g||!b.trim(d.val())){d.val(j.caption)}c.css("background-image","url("+j.url+")")}b(document).on("ptb_post_cmb_gallery_body_handle",function(g){var c=g.cmbItemBody.find(".ptb_cmb_options_wrapper");if(c.length==0){return false}var f=c.children().first().clone();c.sortable({placeholder:"ui-state-highlight"});g.cmbItemBody.find(".ptb_cmb_option_add").click({wrapper:c},function(h){var e=f.clone();e.appendTo(c).hide().show("blind",500);e.find('[name^="'+g.id+'"]').val("");e.find(".ptb_post_cmb_image").removeAttr("style","");e.find("."+g.id+"_remove").click({item:e},d);h.data.wrapper.sortable("refresh")});c.children().each(function(){var e=b(this);e.find("."+g.id+"_remove").click({item:e},d)});function d(h){h.preventDefault();h.data.item.hide("blind",500,function(){b(this).remove()})}b(".ptb_post_cmb_item_gallery").delegate("."+g.id+"_option_wrapper .ptb_post_cmb_image","click",function(h){h.preventDefault();var e=b(this);var i=e.closest("li");wp.media.frames.file_frame=wp.media({title:wp.media.view.l10n.editGalleryTitle,button:{text:b(this).data("uploader_button_text")},frame:"post",state:"gallery-edit",library:{type:"image"},editing:true,multiple:true,selection:false}).on("update",function(j){for(var l in j.models){var k=j.models[l].attributes;if(l==0){a(k,g.id,i)}else{if(l<=j.models.length-1){b("#"+g.id+"_add_new").trigger("click");setTimeout(a(k,g.id),600)}}}}).open()});b(".ptb_post_cmb_item_gallery").delegate('input[name^="'+g.id+'[url]"][type="text"]',"paste keyup keypress change",function(e){var i=b(this);var h=i.closest("li");setTimeout(function(){h.find(".ptb_post_cmb_image").css("background-image","url("+i.val()+")")},100)})});b(document).ready(function(){b("body").delegate('.ptb_extra_gallery_mode input[type="radio"]',"change",function(){var c=b(this).closest(".ptb_back_active_module_content").find(".ptb_extra_gallery_columns");if(b(this).val()=="showcase"){c.slideUp()}else{c.slideDown()}});b(document).on("PTB.template_load",function(){b('.ptb_extra_gallery_mode input[type="radio"]:checked').trigger("change")})})}(jQuery));