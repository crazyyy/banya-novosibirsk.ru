(function(d,b,a,e){if(typeof shortcodes_map_button!="undefined"&&shortcodes_map_button&&shortcodes_map_button.length>0){tinymce.PluginManager.add("ptb_map",function(i,h){var j=[];for(var g in shortcodes_map_button){var f={text:shortcodes_map_button[g].name,body:{type:shortcodes_map_button[g].type},onclick:function(l){var k=this.settings.body;d.ajax({url:$ptb_map_url,type:"POST",dataType:"json",data:{post_type:k.type},success:function(s){if(s){var r=[];var o=s.data;for(var q in o){if(q==="marker"){var n={label:o[q].label,name:q,fixedWidth:true,html:o[q].html,type:"container"}}else{var n={name:q,values:o[q].values?o[q].values:""};n=d.extend(true,n,o[q])}r.push(n)}if(s.taxes){for(var p in s.taxes){var m={label:s.taxes[p].label,name:"ptb_tax_"+s.taxes[p].name,fixedWidth:true,html:'<select class="ptb_map_select" id="ptb_tax_'+s.taxes[p].name+'_select" style="width:100%;" multiple="multiple"><option value="">---</option>',type:"container"};for(var t in s.taxes[p].values){m.html+='<option value="'+s.taxes[p].values[t].slug+'">'+s.taxes[p].values[t].name+"</option>"}m.html+="</select>";r.push(m)}}i.windowManager.open({id:"ptb_map_shortcode_dialog",body:r,title:s.title,minWidth:500,resizable:"yes",onOpen:function(){d("#mce-modal-block").css("zIndex",1000);d("#ptb_map_shortcode_dialog").css("zIndex",1001)},onsubmit:function(x){var y="";var v=d.event.trigger("PTB_Map.insert_shortcode",{shortcode:y,setting:k,data:x.data});if(v){y=v}else{y='[ptb_map_view  post_type="'+k.type+'"';for(var w in x.data){if(d("#"+w+"_select").length>0){var u=d("#"+w+"_select").val();x.data[w]=u?u.join(", "):false}if(x.data[w]){y+=" "+w+'="'+x.data[w]+'"'}}if(d("#marker").val()){y+=' marker="'+d("#marker").val()+'"'}y+="]"}i.insertContent(y)}})}}})},classes:shortcodes_map_button[g].classes};j.push(f)}i.addButton("ptb_map",{icon:"ptb-map-favicon",type:"menubutton",title:"PTB Map View",menu:j})});var c;d("body").delegate(".ptb-icons-list a","click",function(g){g.preventDefault();var f=d(this).attr("href");d("input#marker").val(f);d("#ptb_marker_preview").css("background-image","none").prop("class","fa fa-"+f);d("a.ptb_close_lightbox").trigger("click")}).delegate("#ptb_marker_file","click",function(f){f.preventDefault();if(c){c.open();return}c=wp.media.frames.file_frame=wp.media({title:d(this).data("uploader_title"),button:{text:d(this).data("uploader_button_text")},library:{type:"image"},multiple:false});c.on("select",function(){var g=c.state().get("selection").first().toJSON();d("input#marker").val(g.url);d("#ptb_marker_preview").css("background-image","url("+g.url+")").prop("class","");c.close()});c.open()})}}(jQuery,window,document));