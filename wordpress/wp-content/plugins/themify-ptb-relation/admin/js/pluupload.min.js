function ptb_create_pluploader(b){var f=b,g=f.attr("id"),a=g.replace("plupload-upload-ui",""),c=jQuery;var h=[],i=f.closest("form"),e=i.find(".ptb-relation-error");h=JSON.parse(JSON.stringify(ptb_plupload_config));h.browse_button=a;h.container=f.closest("form").attr("id");h.file_data_name=f.data("name")?f.data("name"):h.file_data_name;h.multipart_params={post_type:"",_nonce:"",action:""};if(f.data("formats")){h.filters=f.data("formats")}var d=new plupload.Uploader(h);d.bind("Init");d.init();d.bind("FilesAdded",function(j,k){if(f.data("confirm")&&!confirm(f.data("confirm"))){return}d.settings.multipart_params.post_type=i.find('input[name="post_type"]').val();d.settings.multipart_params.action=i.find('input[name="action"]').val();d.settings.multipart_params._nonce=i.find('input[name="_nonce"]').val();j.refresh();j.start();i.addClass("ptb-relation-wait")});d.bind("Error",function(j,k){if(k.message){e.text(k.message)}return});d.bind("FileUploaded",function(j,n,k){i.removeClass("ptb-relation-wait");if(k){var m=JSON.parse(k.response);if(m.error){e.text(m.error)}else{if(m.success){var l=i.find(".ptb-relation-loader");l.fadeOut().addClass("done").fadeIn("fast",function(){if(m.redirect){window.location.href=m.redirect}else{setTimeout(function(){l.fadeOut(2000,function(){c(".ptb_close_lightbox").trigger("click")})},1000)}})}}}})};