(function(b){var a=function(){function c(g){return g.split(/,\s*/)}function f(g){return c(g).pop()}var d=b(".ptb-relation-autocomplete");var e=[];d.each(function(){var i=b(this),h=i.data("post_type"),g=i.data("multyply");e[h]={};i.autocomplete({minLength:2,source:function(l,j){var k=l.term;if(k in e[h]){j(e[h][k]);return}b.ajax({url:ajaxurl,dataType:"json",type:"POST",data:{term:l.term,post_type:h,action:"ptb_relation_submission_posts"},success:function(m){e[h][k]=m;j(m)}})},focus:function(j,k){i.autocomplete("search");return false},open:function(){b("ul.ui-menu").width(b(this).innerWidth())},select:function(k,l){var m=i.next("input");if(g){var j=m.val().split(", ");if(b.inArray(l.item.id.toString(),j)===-1){j.push(l.item.id);m.val(j.join(", "));i.val("");i.closest(".ptb_relation_multiply").find("ul").append('<li><span class="ptb_relation_term">'+l.item.label+'</span><span data-id="'+l.item.id+'" class="ti-close ptb_relation_remove_term"></span></li>')}}else{i.val(l.item.label);m.val(l.item.id)}return false}})})};b(document).ready(function(){a();b(".ptb_relation_many").delegate(".ptb_relation_remove_term","click",function(g){g.preventDefault();if(confirm(ptb_relation.confirm)){var f=b(this).closest(".ptb_relation_submission_wrap"),h=f.find('input[type="hidden"]'),d=b.trim(h.val()).split(", "),c=d.indexOf(b(this).data("id").toString());b(this).closest("li").remove();if(c!==-1){d.splice(c,1);h.val(d.join(", "))}}})})}(jQuery));