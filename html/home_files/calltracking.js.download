/* jshint multistr: true */
!function(e,t,n){function a(e,t,n){e="object"==typeof e?e:{},e.url=e.url||window.location.toString(),e.type="POST"===e.type?e.type:"GET",e.timeout=1e3*(e.timeout>0?parseInt(e.timeout):5),e.async=e.async!==!1||e.async,e.headers="object"==typeof e.headers?e.headers:{},e.dataType=["json","text"].indexOf(e.dataType)!==-1?e.dataType:"text"
var i,a=r(),s=null
if("object"==typeof e.data){var o=binotelJqMini.param(e.data)
"GET"===e.type&&""!==o?e.url=(e.url+"&"+o).replace(/[&?]{1,2}/,"?"):"POST"===e.type&&""!==o&&(e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),s=o)}a.onreadystatechange=function(){if(4==a.readyState)if(clearTimeout(i),200==a.status)if("json"==e.dataType)try{t(JSON.parse(a.responseText))}catch(e){n(a,"parsererror")}else"text"==e.dataType&&t(a.responseText)
else n(a,a.statusText)},a.open(e.type,e.url,e.async)
for(headerName in e.headers)a.setRequestHeader(headerName,e.headers[headerName])
e.timeout>0&&(i=setTimeout(function(){a.onreadystatechange=function(){},a.abort(),n(a,"timeout")},e.timeout)),a.send(s)}function r(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml3.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}return null}!function(e){"use strict"
var t=-1,n={onVisible:function(e){var t=n.isSupported()
if(!t||!n.hidden())return e(),t
var i=n.change(function(t,a){n.hidden()||(n.unbind(i),e())})
return i},change:function(e){if(!n.isSupported())return!1
t+=1
var i=t
return n._callbacks[i]=e,n._listen(),i},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){var t=n.isSupported(),i="prerender"
if(!t||i!=n.state())return e(),t
var a=n.change(function(t,r){i!=r&&(n.unbind(a),e())})
return a},hidden:function(){return!(!n._doc.hidden&&!n._doc.webkitHidden)},state:function(){return n._doc.visibilityState||n._doc.webkitVisibilityState||"visible"},isSupported:function(){return!(!n._doc.visibilityState&&!n._doc.webkitVisibilityState)},_doc:document||{},_callbacks:{},_change:function(e){var t=n.state()
for(var i in n._callbacks)n._callbacks[i].call(n._doc,e,t)},_listen:function(){if(!n._init){var e="visibilitychange"
n._doc.webkitVisibilityState&&(e="webkit"+e)
var t=function(){n._change.apply(n,arguments)}
n._doc.addEventListener?n._doc.addEventListener(e,t):n._doc.attachEvent(e,t),n._init=!0}}}
"undefined"!=typeof module&&module.exports,e.bgcVisibility=n}(this),function(e){"use strict"
var t=-1,n=function(n){return n.every=function(e,i,a){n._time(),a||(a=i,i=null),t+=1
var r=t
return n._timers[r]={visible:e,hidden:i,callback:a},n._run(r,!1),n.isSupported()&&n._listen(),r},n.stop=function(e){return!!n._timers[e]&&(n._stop(e),delete n._timers[e],!0)},n._timers={},n._time=function(){n._timed||(n._timed=!0,n._wasHidden=n.hidden(),n.change(function(){n._stopRun(),n._wasHidden=n.hidden()}))},n._run=function(t,i){var a,r=n._timers[t]
if(n.hidden()){if(null===r.hidden)return
a=r.hidden}else a=r.visible
var s=function(){r.last=new Date,r.callback.call(e)}
if(i){var o=new Date,l=o-r.last
a>l?r.delay=setTimeout(function(){s(),r.id=setInterval(s,a)},a-l):(s(),r.id=setInterval(s,a))}else r.id=setInterval(s,a)},n._stop=function(e){var t=n._timers[e]
clearInterval(t.id),clearTimeout(t.delay),delete t.id,delete t.delay},n._stopRun=function(e){var t=n.hidden(),i=n._wasHidden
if(t&&!i||!t&&i)for(var a in n._timers)n._stop(a),n._run(a,!t)},n}
"undefined"!=typeof module&&module.exports,n(e.bgcVisibility)}(window),!function(e){function t(){var e=arguments[0],n=t.cache
return n[e]&&n.hasOwnProperty(e)||(n[e]=t.parse(e)),t.format.call(null,n[e],arguments)}function n(e){return"number"==typeof e?"number":"string"==typeof e?"string":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function i(e,t){return t>=0&&7>=t&&s[e]?s[e][t]:Array(t+1).join(e)}var a={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/bcdiefguxX/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/}
t.format=function(e,r){var s,o,l,c,u,d,f,p=1,m=e.length,g="",h=[],b=!0,y=""
for(o=0;m>o;o++)if(g=n(e[o]),"string"===g)h[h.length]=e[o]
else if("array"===g){if(c=e[o],c[2])for(s=r[p],l=0;l<c[2].length;l++){if(!s.hasOwnProperty(c[2][l]))throw new Error(t('[sprintf] property "%s" does not exist',c[2][l]))
s=s[c[2][l]]}else s=c[1]?r[c[1]]:r[p++]
if(a.not_type.test(c[8])&&a.not_primitive.test(c[8])&&"function"==n(s)&&(s=s()),a.numeric_arg.test(c[8])&&"number"!=n(s)&&isNaN(s))throw new TypeError(t("[sprintf] expecting number but found %s",n(s)))
switch(a.number.test(c[8])&&(b=s>=0),c[8]){case"b":s=parseInt(s,10).toString(2)
break
case"c":s=String.fromCharCode(parseInt(s,10))
break
case"d":case"i":s=parseInt(s,10)
break
case"j":s=JSON.stringify(s,null,c[6]?parseInt(c[6]):0)
break
case"e":s=c[7]?parseFloat(s).toExponential(c[7]):parseFloat(s).toExponential()
break
case"f":s=c[7]?parseFloat(s).toFixed(c[7]):parseFloat(s)
break
case"g":s=c[7]?parseFloat(s).toPrecision(c[7]):parseFloat(s)
break
case"o":s=s.toString(8)
break
case"s":s=String(s),s=c[7]?s.substring(0,c[7]):s
break
case"t":s=String(!!s),s=c[7]?s.substring(0,c[7]):s
break
case"T":s=n(s),s=c[7]?s.substring(0,c[7]):s
break
case"u":s=parseInt(s,10)>>>0
break
case"v":s=s.valueOf(),s=c[7]?s.substring(0,c[7]):s
break
case"x":s=parseInt(s,10).toString(16)
break
case"X":s=parseInt(s,10).toString(16).toUpperCase()}a.json.test(c[8])?h[h.length]=s:(!a.number.test(c[8])||b&&!c[3]?y="":(y=b?"+":"-",s=s.toString().replace(a.sign,"")),d=c[4]?"0"===c[4]?"0":c[4].charAt(1):" ",f=c[6]-(y+s).length,u=c[6]&&f>0?i(d,f):"",h[h.length]=c[5]?y+s+u:"0"===d?y+u+s:u+y+s)}return h.join("")},t.cache={},t.parse=function(e){for(var t=e,n=[],i=[],r=0;t;){if(null!==(n=a.text.exec(t)))i[i.length]=n[0]
else if(null!==(n=a.modulo.exec(t)))i[i.length]="%"
else{if(null===(n=a.placeholder.exec(t)))throw new SyntaxError("[sprintf] unexpected placeholder")
if(n[2]){r|=1
var s=[],o=n[2],l=[]
if(null===(l=a.key.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key")
for(s[s.length]=l[1];""!==(o=o.substring(l[0].length));)if(null!==(l=a.key_access.exec(o)))s[s.length]=l[1]
else{if(null===(l=a.index_access.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key")
s[s.length]=l[1]}n[2]=s}else r|=2
if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported")
i[i.length]=n}t=t.substring(n[0].length)}return i}
var r=function(e,n,i){return i=(n||[]).slice(0),i.splice(0,0,e),t.apply(null,i)},s={0:["","0","00","000","0000","00000","000000","0000000"]," ":[""," ","  ","   ","    ","     ","      ","       "],_:["","_","__","___","____","_____","______","_______"]}
"undefined"!=typeof exports,e.sprintf=t,e.vsprintf=r,"function"==typeof define&&define.amd&&!1&&define(function(){return{sprintf:t,vsprintf:r}})}("undefined"==typeof window?this:window)
var s
for(var o in t.BinotelCallTracking)if(t.BinotelCallTracking[o].initState===!1){t.BinotelCallTracking[o].initState="processing",s=t.BinotelCallTracking[o]
break}if(!s)return!1
console.log("Binotel Call Tracking in processing!!! Widget initiator is %s",s.widgetId)
var l
setTimeout(function(){l=new c,l.init(),s.sendCallTrackingRequest=l.sendCallTrackingRequest},100)
var c=function(){var n={visitorData:null,googleAnalyticsData:null,helpers:{},phoneNumbers:{displayed:"original",original:{},callTracking:{}},statisticsData:{sentCallTrackingRequestTimeLast:0,sentCallTrackingRequestCounter:0},dynamicData:{initializedVisibilityFunctions:!1,intervalOfSendCallTrackingRequest:null,timerOfRestoreOriginalPhoneNumbers:null,timerOfRunVisibleState:null}}
return this.init=function(){n.helpers.preInit(),setInterval(function(){},18e5)},this.sendCallTrackingRequest=function(){n.helpers.sendCallTrackingRequest()},n.helpers.preInit=function(e){return e=e||0,e>=40?(s.debugMode&&console.log("[%s] %s",Date(),"Can't find IATV"),!1):void("undefined"==typeof t.BinotelInformationAboutTheVisitor||"object"!=typeof t.BinotelInformationAboutTheVisitor?setTimeout(function(){n.helpers.preInit(++e)},e<30?100:1e3):setTimeout(function(){n.helpers.init()},50))},n.helpers.init=function(){s.debugMode&&console.log("[%s] %s",Date(),"Run self.helpers.init")
try{n.visitorData=t.BinotelInformationAboutTheVisitor.getVisitorData()}catch(e){console.error(e)}return n.visitorData?(s.type.indexOf("dynamic")>-1?t.BinotelInformationAboutTheVisitor.getGoogleAnalyticsDataViaCallback(function(e){n.googleAnalyticsData=e,bgcVisibility.onVisible(function(){n.helpers.sendCallTrackingRequest()})}):bgcVisibility.onVisible(function(){n.helpers.sendCallTrackingRequest()}),void(s.initState="success")):(console.error("Bad IATV data."),!1)},n.helpers.sendCallTrackingRequest=function(){n.statisticsData.sentCallTrackingRequestTimeLast=Math.floor(Date.now()/1e3),n.statisticsData.sentCallTrackingRequestCounter++,s.debugMode&&console.log("[%s] %s",Date(),"Run self.helpers.sendCallTrackingRequest")
var t=JSON.parse(JSON.stringify(n.visitorData))
0===s.sendUtmDataFirst&&t.utmDataFirst&&delete t.utmDataFirst,0===s.sendUtmDataFirstPaid&&t.utmDataFirstPaid&&delete t.utmDataFirstPaid,0===s.sendUtmDataLastPaid&&t.utmDataLastPaid&&delete t.utmDataLastPaid,a({type:"POST",url:s.backendHost+"/calltracking/getSlot/",data:{widgetID:s.widgetId,visitorData:JSON.parse(JSON.stringify(t)),googleAnalyticsData:JSON.parse(JSON.stringify(n.googleAnalyticsData))},dataType:"json"},function(t){if(t&&"success"===t.status&&t.callTracking){if(s.type.indexOf("dynamic")>-1&&s.dynamicInactivityTime&&(clearTimeout(n.dynamicData.timerOfRestoreOriginalPhoneNumbers),n.dynamicData.timerOfRestoreOriginalPhoneNumbers=setTimeout(function(){n.helpers.restoreOriginalPhoneNumbers()},1e3*s.dynamicInactivityTime)),"original"===n.phoneNumbers.displayed){n.phoneNumbers.callTracking=t.callTracking
for(var i=1;i<=6;i++)for(var a=e.getElementsByClassName("binct-phone-number-"+i),r=0;r<a.length;r++)n.phoneNumbers.original["phoneNumber"+i+"InHtml"]||(n.phoneNumbers.original["phoneNumber"+i+"InHtml"]=a[r].innerHTML),t.callTracking["phoneNumber"+i+"InHtml"]&&(n.phoneNumbers.displayed="callTracking",a[r].innerHTML=t.callTracking["phoneNumber"+i+"InHtml"],"a"===a[r].tagName.toLowerCase()&&/tel:/.test(a[r].getAttribute("href"))&&a[r].setAttribute("href","tel:"+a[r].textContent.toString().replace(/[^\+0-9]/g,"")))}else if(JSON.stringify(t.callTracking)!==JSON.stringify(n.phoneNumbers.callTracking)){for(var o=!0,i=1;i<=6;i++){var a=e.getElementsByClassName("binct-phone-number-"+i)
if(a.length)for(var r=0;r<a.length;r++)t.callTracking["phoneNumber"+i+"InHtml"]?(o=!1,a[r].innerHTML=t.callTracking["phoneNumber"+i+"InHtml"],"a"===a[r].tagName.toLowerCase()&&/tel:/.test(a[r].getAttribute("href"))&&a[r].setAttribute("href","tel:"+a[r].textContent.toString().replace(/[^\+0-9]/g,""))):n.phoneNumbers.original["phoneNumber"+i+"InHtml"]&&(a[r].innerHTML=n.phoneNumbers.original["phoneNumber"+i+"InHtml"],"a"===a[r].tagName.toLowerCase()&&/tel:/.test(a[r].getAttribute("href"))&&a[r].setAttribute("href","#"))}o?n.phoneNumbers.displayed="original":n.phoneNumbers.callTracking=t.callTracking}n.dynamicData.initializedVisibilityFunctions||(n.dynamicData.initializedVisibilityFunctions=!0,s.type.indexOf("dynamic")>-1&&s.dynamicKeepAliveTime&&(n.dynamicData.intervalOfSendCallTrackingRequest=setInterval(function(){n.helpers.sendCallTrackingRequest()},1e3*s.dynamicKeepAliveTime),bgcVisibility.isSupported()&&bgcVisibility.change(function(e,t){if("visible"===t){clearTimeout(n.dynamicData.timerOfRunVisibleState)
var i=Math.floor(Date.now()/1e3)-n.statisticsData.sentCallTrackingRequestTimeLast
i+5>s.dynamicKeepAliveTime?(n.helpers.sendCallTrackingRequest(),clearInterval(n.dynamicData.intervalOfSendCallTrackingRequest),n.dynamicData.intervalOfSendCallTrackingRequest=setInterval(function(){n.helpers.sendCallTrackingRequest()},1e3*s.dynamicKeepAliveTime)):n.dynamicData.timerOfRunVisibleState=setTimeout(function(){n.helpers.sendCallTrackingRequest(),clearInterval(n.dynamicData.intervalOfSendCallTrackingRequest),n.dynamicData.intervalOfSendCallTrackingRequest=setInterval(function(){n.helpers.sendCallTrackingRequest()},1e3*s.dynamicKeepAliveTime)},1e3*(s.dynamicKeepAliveTime-i-5))}else"hidden"===t&&(clearTimeout(n.dynamicData.timerOfRunVisibleState),clearInterval(n.dynamicData.intervalOfSendCallTrackingRequest))})))}else n.helpers.restoreOriginalPhoneNumbers()},function(e,t){console.log(t,e)})},n.helpers.restoreOriginalPhoneNumbers=function(){if(s.debugMode&&console.log("[%s] %s",Date(),"Run self.helpers.restoreOriginalPhoneNumbers"),"original"!==n.phoneNumbers.displayed){n.phoneNumbers.displayed="original"
for(var t in n.phoneNumbers.original){var i=0
"phoneNumber1InHtml"===t?i=1:"phoneNumber2InHtml"===t?i=2:"phoneNumber3InHtml"===t?i=3:"phoneNumber4InHtml"===t?i=4:"phoneNumber5InHtml"===t?i=5:"phoneNumber6InHtml"===t&&(i=6)
var a=e.getElementsByClassName("binct-phone-number-"+i)
if(a.length)for(var r=0;r<a.length;r++)n.phoneNumbers.original[t]&&n.phoneNumbers.original[t]!==a[r].innerHTML&&(a[r].innerHTML=n.phoneNumbers.original[t],"a"===a[r].tagName.toLowerCase()&&/tel:/.test(a[r].getAttribute("href"))&&a[r].setAttribute("href","#"))}}},n.helpers.parseQueryString=function(e){for(var t,n=/[?&]([^=#&]+)=([^&#]*)/g,i={};t=n.exec(e);)try{i[decodeURIComponent(t[1])]=decodeURIComponent(t[2])}catch(e){}return i},n.helpers.parseReferrer=function(e){var t={hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",port:"",protocol:"",search:""}
if(""!==e){var n=document.createElement("a")
n.href=e,t.hash=n.hash,t.host=n.host,t.hostname=n.hostname,t.href=n.href,t.origin=n.origin,t.pathname=n.pathname,t.port=n.port,t.protocol=n.protocol,t.search=n.search}return t},n.helpers.setClientSideTimeOffset=function(e){a({type:"GET",url:s.backendHost+"/getcall/getTimestamp/",dataType:"json"},function(t){t&&t.timestamp?s.clientSideTimeOffset=t.timestamp-Math.floor(Date.now()/1e3):e!==!0&&setTimeout(function(){n.helpers.setClientSideTimeOffset(!0)},12e4)},function(t,i){console.log(i,t),e!==!0&&setTimeout(function(){n.helpers.setClientSideTimeOffset(!0)},12e4)})},this}
Date.now||(Date.now=function(){return(new Date).getTime()}),function(e){var t={},n={},a=n.toString,r=/%20/g,s=/\[\]$/
e.binotelJqMini=t,t.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[a.call(e)]||"object":typeof e},t.isFunction=function(e){return"function"===t.type(e)},t.buildParams=function(e,n,a){var r,o,l
if(Array.isArray(n))for(var o in n)l=n[o],s.test(e)?a(e,l):t.buildParams(e+"["+("object"==typeof v?i:"")+"]",l,a)
else if("object"===t.type(n))for(r in n)t.buildParams(e+"["+r+"]",n[r],a)
else a(e,n)},t.param=function(e){var n,i,a
if(serialized=[],add=function(e,n){n=t.isFunction(n)?n():null==n?"":n,serialized[serialized.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)},Array.isArray(e))for(i in e)a=e[i],add(i,a)
else for(n in e)t.buildParams(n,e[n],add)
return serialized.join("&").replace(r,"+")}}(window)}(document,window,"script")
